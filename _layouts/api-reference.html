<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ page.title }} - {{ site.title }}</title>
  <meta name="description" content="{{ page.description }}">

  <!-- Styles -->
  <link rel="stylesheet" href="{{ '/assets/css/docs.css' | relative_url }}">

  <!-- Redoc -->
  <script src="https://cdn.redoc.ly/redoc/latest/bundles/redoc.standalone.js"></script>

  <style>
    /* Override default body styles for full-width Redoc */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
    }

    .top-nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
    }

    .redoc-wrap {
      position: fixed;
      top: 60px;
      left: 0;
      right: 0;
      bottom: 0;
      overflow: auto;
    }

    /* Ensure Redoc content is scrollable */
    redoc {
      display: block;
      height: 100%;
      overflow: auto;
    }
  </style>
</head>
<body>
    <!-- Top Navigation Bar -->
    <nav class="top-nav">
        <div class="nav-container">
            <div class="nav-left">
                <a href="{{ '/' | relative_url }}" class="logo">
                    <i class="fas fa-cube"></i>
                    <span>Quub Exchange</span>
                </a>
            </div>
            <div class="nav-center">
                <a href="{{ '/docs/' | relative_url }}" class="nav-link">Documentation</a>
                <a href="{{ '/api-reference/' | relative_url }}" class="nav-link active">API Reference</a>
                <a href="{{ '/guides/' | relative_url }}" class="nav-link">Guides</a>
                <a href="{{ '/changelog/' | relative_url }}" class="nav-link">Changelog</a>
            </div>
            <div class="nav-right">
                <div class="api-selector">
                    <select id="apiSelector" onchange="window.location.href=this.value">
                        <option value="">Select API...</option>
                        <optgroup label="Core Platform">
                            <option value="{{ '/api-reference/auth/' | relative_url }}" {% if page.api == 'auth' %}selected{% endif %}>Auth Service</option>
                            <option value="{{ '/api-reference/identity/' | relative_url }}" {% if page.api == 'identity' %}selected{% endif %}>Identity Service</option>
                            <option value="{{ '/api-reference/tenancy-trust/' | relative_url }}" {% if page.api == 'tenancy-trust' %}selected{% endif %}>Tenancy & Trust</option>
                        </optgroup>
                        <optgroup label="Trading & Markets">
                            <option value="{{ '/api-reference/exchange/' | relative_url }}" {% if page.api == 'exchange' %}selected{% endif %}>Exchange</option>
                            <option value="{{ '/api-reference/marketplace/' | relative_url }}" {% if page.api == 'marketplace' %}selected{% endif %}>Marketplace</option>
                            <option value="{{ '/api-reference/gateway/' | relative_url }}" {% if page.api == 'gateway' %}selected{% endif %}>Gateway</option>
                            <option value="{{ '/api-reference/market-oracles/' | relative_url }}" {% if page.api == 'market-oracles' %}selected{% endif %}>Market Oracles</option>
                            <option value="{{ '/api-reference/pricing-refdata/' | relative_url }}" {% if page.api == 'pricing-refdata' %}selected{% endif %}>Pricing & RefData</option>
                        </optgroup>
                        <optgroup label="Financial Services">
                            <option value="{{ '/api-reference/custodian/' | relative_url }}" {% if page.api == 'custodian' %}selected{% endif %}>Custodian</option>
                            <option value="{{ '/api-reference/treasury/' | relative_url }}" {% if page.api == 'treasury' %}selected{% endif %}>Treasury</option>
                            <option value="{{ '/api-reference/fiat-banking/' | relative_url }}" {% if page.api == 'fiat-banking' %}selected{% endif %}>Fiat Banking</option>
                            <option value="{{ '/api-reference/settlements/' | relative_url }}" {% if page.api == 'settlements' %}selected{% endif %}>Settlements</option>
                            <option value="{{ '/api-reference/escrow/' | relative_url }}" {% if page.api == 'escrow' %}selected{% endif %}>Escrow</option>
                            <option value="{{ '/api-reference/fees-billing/' | relative_url }}" {% if page.api == 'fees-billing' %}selected{% endif %}>Fees & Billing</option>
                        </optgroup>
                        <optgroup label="Capital Markets">
                            <option value="{{ '/api-reference/primary-market/' | relative_url }}" {% if page.api == 'primary-market' %}selected{% endif %}>Primary Market</option>
                            <option value="{{ '/api-reference/transfer-agent/' | relative_url }}" {% if page.api == 'transfer-agent' %}selected{% endif %}>Transfer Agent</option>
                            <option value="{{ '/api-reference/documents/' | relative_url }}" {% if page.api == 'documents' %}selected{% endif %}>Documents</option>
                        </optgroup>
                        <optgroup label="Operations & Compliance">
                            <option value="{{ '/api-reference/compliance/' | relative_url }}" {% if page.api == 'compliance' %}selected{% endif %}>Compliance</option>
                            <option value="{{ '/api-reference/risk-limits/' | relative_url }}" {% if page.api == 'risk-limits' %}selected{% endif %}>Risk & Limits</option>
                            <option value="{{ '/api-reference/governance/' | relative_url }}" {% if page.api == 'governance' %}selected{% endif %}>Governance</option>
                            <option value="{{ '/api-reference/analytics-reports/' | relative_url }}" {% if page.api == 'analytics-reports' %}selected{% endif %}>Analytics & Reports</option>
                        </optgroup>
                        <optgroup label="Infrastructure">
                            <option value="{{ '/api-reference/chain/' | relative_url }}" {% if page.api == 'chain' %}selected{% endif %}>Chain Integration</option>
                            <option value="{{ '/api-reference/events/' | relative_url }}" {% if page.api == 'events' %}selected{% endif %}>Events</option>
                            <option value="{{ '/api-reference/notifications/' | relative_url }}" {% if page.api == 'notifications' %}selected{% endif %}>Notifications</option>
                            <option value="{{ '/api-reference/observability/' | relative_url }}" {% if page.api == 'observability' %}selected{% endif %}>Observability</option>
                            <option value="{{ '/api-reference/sandbox/' | relative_url }}" {% if page.api == 'sandbox' %}selected{% endif %}>Sandbox</option>
                        </optgroup>
                    </select>
                </div>
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                    <i class="fas fa-moon"></i>
                </button>
                <a href="https://github.com/{{ site.repository }}" class="github-link" target="_blank" rel="noopener">
                    <i class="fab fa-github"></i>
                </a>
            </div>
        </div>
    </nav>

    <!-- API Documentation Container -->
    <div class="api-container" style="position: fixed; top: 60px; left: 0; right: 0; bottom: 0; overflow-y: auto;">
        {% if page.service %}
        <div class="api-documentation-banner" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; margin-bottom: 0;">
            <div style="max-width: 1200px; margin: 0 auto;">
                <h2 style="margin: 0 0 10px 0; font-size: 24px;">{{ page.title }}</h2>
                <p style="margin: 0 0 15px 0; opacity: 0.9;">{{ page.description }}</p>
                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                    <a href="{{ site.baseurl }}/capabilities/{{ page.service }}/"
                       style="background: rgba(255,255,255,0.2); color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; display: inline-flex; align-items: center; gap: 6px; font-weight: 500; transition: all 0.2s;"
                       onmouseover="this.style.background='rgba(255,255,255,0.3)'"
                       onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                        üìñ Use Case Overview
                    </a>
                    <a href="{{ site.baseurl }}/capabilities/{{ page.service }}/{{ page.service }}-api-documentation/"
                       style="background: rgba(255,255,255,0.2); color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; display: inline-flex; align-items: center; gap: 6px; font-weight: 500; transition: all 0.2s;"
                       onmouseover="this.style.background='rgba(255,255,255,0.3)'"
                       onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                        üìö Implementation Guide
                    </a>
                    <a href="https://quub-fi.github.io/quub-exchange-docs/openapi/{{ page.service }}.json"
                       target="_blank"
                       style="background: rgba(255,255,255,0.2); color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; display: inline-flex; align-items: center; gap: 6px; font-weight: 500; transition: all 0.2s;"
                       onmouseover="this.style.background='rgba(255,255,255,0.3)'"
                       onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                        ‚¨áÔ∏è Download OpenAPI Spec
                    </a>
                    <a href="https://quub-fi.github.io/quub-exchange-docs/openapi/{{ page.service }}.yaml"
                       target="_blank"
                       style="background: rgba(255,255,255,0.2); color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; display: inline-flex; align-items: center; gap: 6px; font-weight: 500; transition: all 0.2s;"
                       onmouseover="this.style.background='rgba(255,255,255,0.3)'"
                       onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                        üìÑ Download YAML Spec
                    </a>
                </div>
            </div>
        </div>
        {% endif %}
        <div id="redoc-container"></div>
    </div>

    <script>
        // Initialize Redoc with the OpenAPI spec
        const baseUrl = window.location.origin;
        const serviceName = '{{ page.service }}' || '{{ page.api }}';
        const specUrl = baseUrl + '/quub-exchange-docs/openapi/' + serviceName + '.json';
        console.log('Service name:', serviceName);
        console.log('Loading OpenAPI spec from:', specUrl);

        Redoc.init(
            specUrl,
            {
                scrollYOffset: 0,
                hideDownloadButton: false,
                theme: {
                    typography: {
                        fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                        code: {
                            fontFamily: 'JetBrains Mono, Consolas, Monaco, monospace'
                        }
                    },
                    sidebar: {
                        width: '280px',
                        backgroundColor: '#fafafa'
                    },
                    colors: {
                        primary: {
                            main: '#6366f1'
                        }
                    }
                }
            },
            document.getElementById('redoc-container')
        ).catch(error => {
            console.error('Failed to load API specification:', error);
            document.getElementById('redoc-container').innerHTML = `
                <div style="padding: 40px; text-align: center; font-family: Inter, sans-serif;">
                    <h2 style="color: #ef4444;">Failed to Load API Specification</h2>
                    <p>Could not load: <code>${specUrl}</code></p>
                    <p style="color: #6b7280;">Please check the console for more details.</p>
                    <a href="/quub-exchange-docs/openapi/{{ page.api }}.json" target="_blank" style="color: #6366f1;">View Raw Specification</a>
                </div>
            `;
        });
    </script>
</body>
</html>
